!function(a,r,s){function e(){var r={Email:a("#signin .email").val(),Password:a("#signin .password").val()};return a.ajax({url:a("#signin").data("url"),type:"POST",dateType:"json",data:r})}function d(){var r={Email:a("#signup .email").val(),Password:a("#signup .password").val(),ConfirmPassword:a("#signup .confirmPassword").val(),Username:a("#signup .username").val()};return a.ajax({url:a("#signup").data("url"),type:"POST",dateType:"json",data:r})}function n(){var r={Title:a("#addstory .title").val(),Url:a("#addstory .url").val(),DescriptionMarkdown:a("#addstory .description").val(),IsAuthor:a("#addstory .isauthor").val()};return a.ajax({url:a("#addstory").data("url"),type:"POST",dataType:"json",data:r})}function t(r){return a.ajax({url:a("#add-comment").data("url"),type:"POST",dataType:"json",data:r})}function i(r){return a.ajax({url:r.url,type:"POST",dataType:"json",data:r.form})}function o(r){return a.ajax({url:a("#changepassword").data("url"),type:"POST",dataType:"json",data:r})}function l(r,s){return a.ajax({url:r,type:"POST",dataType:"json",data:{hashId:s}})}function c(r,s){return a.ajax({url:r,type:"POST",dataType:"json",data:{Email:s}})}function u(r,s){return a.ajax({url:r,type:"POST",dataType:"json",data:s})}a(function(){a(s).keypress(function(r){13==r.which&&a(".return-submit").click()}),a("#signin").on("click","button.submit",function(){e().done(function(s){return 0==s.status?(a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1):(a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),r.location.href=a.QueryString.returnUrl,!1)})}),a("#signup").on("click","button.signup",function(){d().done(function(s){return 0==s.status?(a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1):(a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),r.location.href=a.QueryString.returnUrl,!1)})}),a("#addstory").on("click","button.submit",function(){return n().done(function(s){if(0==s.status)return a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1;a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),r.location.href=a.QueryString.returnUrl}),!1}),a("#addstory").on("click","button.reset",function(){var r=a(this).closest("#addstory");r.find("input").each(function(){a(this).val("")}),r.find("textarea").each(function(){a(this).val("")}),r.find("input:checked").each(function(){a(this).attr("checked",!1)})}),a("#add-comment").on("click","button.add-comment-btn",function(){var r=a(this),s=r.parent().closest("#add-comment").find("textarea.add-comment");t({StoryHashId:a(".story").data("hashid"),CommentMarkdown:s.val()}).success(function(r){return 0==r.status?(a("div#error").removeClass("hidden").append('<div class="error">'+r.message+"</div>"),!1):(a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),a.get(a("#comments").data("get")+"/?hashId="+r.commentHashId,function(r){a(r).prependTo("#comments")}),s.val(""),!1)})}),a("#comments").on("click","button.add-comment-btn",function(){var r=a(this).parent().closest(".comment"),s=r.find("textarea.add-comment");t({ParentCommentHashId:r.data("hashid"),StoryHashId:a(".story").data("hashid"),CommentMarkdown:s.val()}).success(function(s){return 0==s.status?(a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1):(a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),a.get(a("#comments").data("get")+"/?hashId="+s.commentHashId,function(s){r.after(a("<ol><li></li></ol>").append(s).addClass("reply"))}),r.find(".comment-reply").remove(),!1)})}),a("#invite-user").on("click","button.submit",function(){var r=a(this).closest("#invite-user");r.find("sucess").addClass("hidden"),c(r.data("url"),r.find(".email").val()).done(function(s){if(0==s.status)return a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1;a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),r.find("#success").removeClass("hidden"),r.find(".email").val("")})}),a("#referral").on("click","button.submit",function(){var s=a(this).closest("#referral"),e={Username:s.find("input.username").val(),Email:s.find("input.email").val(),Password:s.find("input.password").val(),ConfirmPassword:s.find("input.confirmPassword").val(),Code:s.find("input#Code").val()};u(s.data("url"),e).done(function(){if(0==e.status){for(var s=a("div#error").removeClass("hidden"),d=0;d<e.messages.length-1;d++)s.append('<div class="error">'+e.messages[d]+"</div>");return!1}a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),r.location.href="/"})}),a("#updatepassword").on("click","button.submit",function(){var r=a(this).parent().closest("#changepassword");o({OldPassword:r.find("#OldPassword").val(),NewPassword:r.find("#NewPassword").val(),ConfirmNewPassword:r.find("#ConfirmNewPassword").val()}).success(function(s){if(r.find("#OldPassword").val(""),r.find("#NewPassword").val(""),r.find("#ConfirmNewPassword").val(""),0==s.status)return a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1;a("div#error").hasClass("hidden")||a("div#error").addClass("hidden")})}),a("div.vote").on("click","i",function(){var r=a(this),s=null,e=r.parents(".vote");r.parents("div").hasClass("story")?s=r.closest(".story"):r.parents("div").hasClass("comment")&&(s=r.closest(".comment")),l(e.data("url"),s.data("hashid")).done(function(s){if(s.status=!1)return a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1;a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),r.toggleClass("active");var d=e.find(".score"),n=parseInt(d.html());return r.hasClass("active")?n++:n--,d.html(n),!1})}),a("div#comments").on("click","a.reply",function(){var r=a(this),s=(a("#add-comment").data("url"),a("<div></div>").addClass("comment-reply")),e=a("<textarea></textarea>").addClass("form-control add-comment").attr("rows",5);return s.append(e),a("#add-comment .btn-block").clone().appendTo(s),r.closest(".comment").append(s),!1}),a("div.story").on("click","i.fa-trash",function(){a(this);i({url:a(this).closest("div.delete-story").data("url"),form:{hashId:a(this).closest("div.story").data("hashid")}}).success(function(s){return 0==s.status?(a("div#error").removeClass("hidden").append('<div class="error">'+s.message+"</div>"),!1):(a("div#error").hasClass("hidden")||a("div#error").addClass("hidden"),r.location.href="/",!1)})})}),a.QueryString=function(a){if(""==a)return{};for(var r={},s=0;s<a.length;++s){var e=a[s].split("=",2);2==e.length&&(r[e[0]]=decodeURIComponent(e[1].replace(/\+/g," ")))}return r}(r.location.search.substr(1).split("&"))}(window.jQuery,window,document);