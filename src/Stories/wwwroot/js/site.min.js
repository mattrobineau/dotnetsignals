!function(t,a,n){function s(){var a={Email:t("#signin .email").val(),Password:t("#signin .password").val()};return t.ajax({url:t("#signin").data("url"),type:"POST",dateType:"json",data:a})}function e(){var a={Email:t("#signup .email").val(),Password:t("#signup .password").val(),ConfirmPassword:t("#signup .confirmPassword").val(),Username:t("#signup .username").val()};return t.ajax({url:t("#signup").data("url"),type:"POST",dateType:"json",data:a})}function r(){var a={Title:t("#addstory .title").val(),Url:t("#addstory .url").val(),DescriptionMarkdown:t("#addstory .description").val(),IsAuthor:t("#addstory .isauthor").val()};return t.ajax({url:t("#addstory").data("url"),type:"POST",dataType:"json",data:a})}function o(a){return t.ajax({url:t("#add-comment").data("url"),type:"POST",dataType:"json",data:a})}function i(a){return t.ajax({url:a.url,type:"POST",dataType:"json",data:a.form})}function d(a){return t.ajax({url:t("#changepassword").data("url"),type:"POST",dataType:"json",data:a})}function u(a,n){return t.ajax({url:a,type:"POST",dataType:"json",data:{hashId:n}})}function c(a,n){return t.ajax({url:a,type:"POST",dataType:"json",data:{Email:n}})}function l(a,n){return t.ajax({url:a,type:"POST",dataType:"json",data:n})}function m(a){var n=t("div#error");if(n.find(".error").remove(),!a||a.length<=0)return void(n.hasClass("hidden")||n.addClass("hidden"));n.hasClass("hidden")&&n.removeClass("hidden");for(var s=0;s<a.length;s++)n.append(t("<div></div>").addClass("error").append(t("<span></span>").text(a[s])))}t(function(){t(n).keypress(function(a){13==a.which&&t(".return-submit").click()}),t("#signin").on("click","button.submit",function(){s().done(function(n){return 0==n.status?(m(n.messages),!1):(m(),a.location.href=t.QueryString.returnUrl,!1)})}),t("#signup").on("click","button.signup",function(){e().done(function(n){return 0==n.status?(m(n.messages),!1):(m(),a.location.href=t.QueryString.returnUrl,!1)})}),t("#addstory").on("click","button.submit",function(){return r().done(function(n){if(0==n.status)return m(n.messages),!1;m(),a.location.href=t.QueryString.returnUrl}),!1}),t("#addstory").on("click","button.reset",function(){var a=t(this).closest("#addstory");a.find("input").each(function(){t(this).val("")}),a.find("textarea").each(function(){t(this).val("")}),a.find("input:checked").each(function(){t(this).attr("checked",!1)})}),t("#add-comment").on("click","button.add-comment-btn",function(){var a=t(this),n=a.parent().closest("#add-comment").find("textarea.add-comment");o({StoryHashId:t(".story").data("hashid"),CommentMarkdown:n.val()}).success(function(a){return 0==a.status?(m(a.messages),!1):(m(),t.get(t("#comments").data("get")+"/?hashId="+a.commentHashId,function(a){t(a).prependTo("#comments")}),n.val(""),!1)})}),t("#comments").on("click","button.add-comment-btn",function(){var a=t(this).parent().closest(".comment"),n=a.find("textarea.add-comment");o({ParentCommentHashId:a.data("hashid"),StoryHashId:t(".story").data("hashid"),CommentMarkdown:n.val()}).success(function(n){return 0==n.status?(m(n.messages),!1):(m(),t.get(t("#comments").data("get")+"/?hashId="+n.commentHashId,function(n){a.after(t("<ol><li></li></ol>").append(n).addClass("reply"))}),a.find(".comment-reply").remove(),!1)})}),t("#invite-user").on("click","button.submit",function(){var a=t(this).closest("#invite-user");a.find("sucess").addClass("hidden"),c(a.data("url"),a.find(".email").val()).done(function(t){if(0==t.status)return m(t.messages),!1;m(),a.find("#success").removeClass("hidden"),a.find(".email").val(""),a.find("label[for=email]").text("Email ("+t.remaninginvites+")")})}),t("#referral").on("click","button.submit",function(){var n=t(this).closest("#referral"),s={Username:n.find("input.username").val(),Email:n.find("input.email").val(),Password:n.find("input.password").val(),ConfirmPassword:n.find("input.confirmPassword").val(),Code:n.find("input#Code").val()};l(n.data("url"),s).done(function(){if(0==s.status)return m(s.messages),!1;m(),a.location.href="/"})}),t("#updatepassword").on("click","button.submit",function(){var a=t(this).parent().closest("#changepassword");d({OldPassword:a.find("#OldPassword").val(),NewPassword:a.find("#NewPassword").val(),ConfirmNewPassword:a.find("#ConfirmNewPassword").val()}).success(function(t){if(a.find("#OldPassword").val(""),a.find("#NewPassword").val(""),a.find("#ConfirmNewPassword").val(""),0==t.status)return m(t.messages),!1;m()})}),t("div.vote").on("click","i",function(){var a=t(this),n=null,s=a.parents(".vote");a.parents("div").hasClass("story")?n=a.closest(".story"):a.parents("div").hasClass("comment")&&(n=a.closest(".comment")),u(s.data("url"),n.data("hashid")).done(function(t){if(0==t.status)return m(t.messages),!1;m(),a.toggleClass("active");var n=s.find(".score"),e=parseInt(n.html());return a.hasClass("active")?e++:e--,n.html(e),!1})}),t("div#comments").on("click","a.reply",function(){var a=t(this),n=(t("#add-comment").data("url"),t("<div></div>").addClass("comment-reply")),s=t("<textarea></textarea>").addClass("form-control add-comment").attr("rows",5);return n.append(s),t("#add-comment .btn-block").clone().appendTo(n),a.closest(".comment").append(n),!1}),t("div.story").on("click","i.fa-trash",function(){t(this);i({url:t(this).closest("div.delete-story").data("url"),form:{hashId:t(this).closest("div.story").data("hashid")}}).success(function(t){return 0==t.status?(m(t.messages),!1):(m(),a.location.href="/",!1)})})}),t.QueryString=function(t){if(""==t)return{};for(var a={},n=0;n<t.length;++n){var s=t[n].split("=",2);2==s.length&&(a[s[0]]=decodeURIComponent(s[1].replace(/\+/g," ")))}return a}(a.location.search.substr(1).split("&"))}(window.jQuery,window,document);