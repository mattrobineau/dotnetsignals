!function(n,s,a){"use strict";function t(){var s={Email:n("#signin .email").val(),Password:n("#signin .password").val()};return n.ajax({url:n("#signin").data("url"),type:"POST",dateType:"json",data:s})}function e(){var s={Email:n("#signup .email").val(),Password:n("#signup .password").val(),ConfirmPassword:n("#signup .confirmPassword").val(),Username:n("#signup .username").val()};return n.ajax({url:n("#signup").data("url"),type:"POST",dateType:"json",data:s})}function r(s){return n.ajax({url:n("#changepassword").data("url"),type:"POST",dataType:"json",data:s})}function i(s,a){return n.ajax({url:s,type:"POST",dataType:"json",data:{hashId:a}})}function o(s,a){return n.ajax({url:s,type:"POST",dataType:"json",data:{Email:a}})}function d(s,a){return n.ajax({url:s,type:"POST",dataType:"json",data:a})}function u(s){var a=n("div#error");if(a.find(".error").remove(),!s||s.length<=0)return void(a.hasClass("hidden")||a.addClass("hidden"));a.hasClass("hidden")&&a.removeClass("hidden");for(var t=0;t<s.length;t++)a.append(n("<div></div>").addClass("error").append(n("<span></span>").text(s[t])))}n(function(){n(a).keypress(function(s){13==s.which&&n(".return-submit").click()}),n("#signin").on("click","button.submit",function(){t().done(function(a){return 0==a.status?(u(a.messages),!1):(u(),s.location.href=n.QueryString.returnUrl,!1)})}),n("#signup").on("click","button.signup",function(){e().done(function(a){return 0==a.status?(u(a.messages),!1):(u(),s.location.href=n.QueryString.returnUrl,!1)})}),n("#invite-user").on("click","button.submit",function(){var s=n(this).closest("#invite-user");s.find("sucess").addClass("hidden"),o(s.data("url"),s.find(".email").val()).done(function(n){if(0==n.status)return u(n.messages),!1;u(),s.find("#success").removeClass("hidden"),s.find(".email").val(""),s.find("label[for=email]").text("Email ("+n.remaninginvites+")")})}),n("#referral").on("click","button.submit",function(){var a=n(this).closest("#referral"),t={Username:a.find("input.username").val(),Email:a.find("input.email").val(),Password:a.find("input.password").val(),ConfirmPassword:a.find("input.confirmPassword").val(),Code:a.find("input#Code").val()};d(a.data("url"),t).done(function(){if(0==t.status)return u(t.messages),!1;u(),s.location.href="/"})}),n("#updatepassword").on("click","button.submit",function(){var s=n(this).parent().closest("#changepassword");r({OldPassword:s.find("#OldPassword").val(),NewPassword:s.find("#NewPassword").val(),ConfirmNewPassword:s.find("#ConfirmNewPassword").val()}).success(function(n){if(s.find("#OldPassword").val(""),s.find("#NewPassword").val(""),s.find("#ConfirmNewPassword").val(""),0==n.status)return u(n.messages),!1;u()})}),n("div.vote").on("click","i",function(){var s=n(this),a=null,t=s.parents(".vote");s.parents("div").hasClass("story")?a=s.closest(".story"):s.parents("div").hasClass("comment")&&(a=s.closest(".comment")),i(t.data("url"),a.data("hashid")).done(function(n){if(0==n.status)return u(n.messages),!1;u(),s.toggleClass("active");var a=t.find(".score"),e=parseInt(a.html());return s.hasClass("active")?e++:e--,a.html(e),!1})})}),n.QueryString=function(n){if(""==n)return{};for(var s={},a=0;a<n.length;++a){var t=n[a].split("=",2);2==t.length&&(s[t[0]]=decodeURIComponent(t[1].replace(/\+/g," ")))}return s}(s.location.search.substr(1).split("&"))}(window.jQuery,window,document);