!function(t,a,n){"use strict";function e(a){return t.ajax({url:t("#add-comment").data("url"),type:"POST",dataType:"json",data:a})}function d(a){var n=t("div#error");if(n.find(".error").remove(),!a||a.length<=0)return void(n.hasClass("hidden")||n.addClass("hidden"));n.hasClass("hidden")&&n.removeClass("hidden");for(var e=0;e<a.length;e++)n.append(t("<div></div>").addClass("error").append(t("<span></span>").text(a[e])))}function o(a){return t.ajax({url:a.url,type:"POST",dataType:"json",data:a.body})}t(function(){t("#add-comment").on("click","button.add-comment-btn",function(){var a=t(this),n=a.parent().closest("#add-comment").find("textarea.add-comment");e({StoryHashId:t(".story").data("hashid"),CommentMarkdown:n.val()}).success(function(a){return!1===a.status?(d(a.messages),!1):(d(),t.get(t("#comments").data("get")+"/?hashId="+a.commentHashId,function(a){t(a).prependTo("#comments")}),n.val(""),!1)})}),t("#comments").on("click","button.add-comment-btn",function(){var a=t(this).parent().closest(".comment"),n=a.find("textarea.add-comment");e({ParentCommentHashId:a.data("hashid"),StoryHashId:t(".story").data("hashid"),CommentMarkdown:n.val()}).success(function(n){return!1===n.status?(d(n.messages),!1):(d(),t.get(t("#comments").data("get")+"/?hashId="+n.commentHashId,function(n){a.after(t("<ol><li></li></ol>").append(n).addClass("reply"))}),a.find(".comment-reply").remove(),!1)})}),t("div#comments").on("click","a.reply",function(){var a=t(this);if(a.closest(".comment").find(".comment-reply").length>0)return!1;var n=t("<div></div>").addClass("comment-reply"),e=t("<textarea></textarea>").addClass("form-control add-comment").attr("rows",5);return n.append(e),t("#add-comment .btn-block").clone().appendTo(n),a.closest(".comment").append(n),!1}),t("div#comments").on("click","i.fa-flag",function(){var a=t(this);o({url:a.data("url"),body:{hashId:a.closest("div.comment").data("hashid")}}).success(function(t){return!1===t.status?(d(t.messages),!1):(d(),!1)})})})}(window.jQuery,window,document);